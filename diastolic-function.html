<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ASE 2016 Diastolic Dysfunction Grading</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fafbfc; margin: 2em; max-width: 720px;}
    h2 { color: #024; }
    label { font-weight: bold; }
    input, select { margin: 0.2em 0.7em 0.7em 0.3em; }
    .result { font-weight: bold; font-size: 1.1em; margin: 1em 0; color: #227; }
    .section { margin-bottom: 2em;}
    .diagram-wrap { text-align:center; margin:2em 0;}
    @media (max-width: 850px) {
      body { margin: 0.5em; }
      .diagram-wrap { margin: 1em 0; }
    }
  </style>
</head>
<body>
<h2>ASE 2016 Diastolic Dysfunction Grading Tool</h2>
<form id="diastolicForm">
  <label>LVEF reduced? </label>
  <select id="ef_reduced">
    <option value="no">No</option>
    <option value="yes">Yes</option>
  </select>
  <br>
  <label>E/e′:</label>
  <input type="number" id="ee" step="0.1" placeholder="E/e′"><br>
  <label>Septal e′ (cm/s):</label>
  <input type="number" id="septal" step="0.1" placeholder="Septal e′"><br>
  <label>Lateral e′ (cm/s):</label>
  <input type="number" id="lateral" step="0.1" placeholder="Lateral e′"><br>
  <label>TR velocity (m/s):</label>
  <input type="number" id="tr" step="0.1" placeholder="TR velocity"><br>
  <label>LA volume index (ml/m²):</label>
  <input type="number" id="lavi" step="0.1" placeholder="LAVI"><br>
  <label>E/A ratio:</label>
  <input type="number" id="ea" step="0.01" placeholder="E/A"><br>
  <label>Mitral E velocity (cm/s):</label>
  <input type="number" id="evel" step="0.1" placeholder="E velocity"><br>
  <button type="button" onclick="gradeDiastolic()">Grade Diastolic Function</button>
</form>
<div class="result" id="dfout"></div>

<div class="diagram-wrap">
  <svg width="700" height="390" viewBox="0 0 700 390" style="max-width:99%;height:auto;background:#f8fafd;border-radius:16px;box-shadow:0 3px 12px #bbc;">
    <rect x="10" y="10" width="680" height="370" rx="18" fill="#fff" stroke="#aad" stroke-width="2"/>
    <text x="350" y="36" font-size="22" font-family="Arial" text-anchor="middle" fill="#045" font-weight="bold">ASE 2016 Diastolic Function Grading</text>
    <!-- Step 1: Criteria -->
    <rect x="50" y="56" width="600" height="60" rx="12" fill="#eef" stroke="#bbb"/>
    <text x="350" y="81" font-size="15" font-family="Arial" text-anchor="middle" fill="#046">Apply ALL 4 Criteria:</text>
    <foreignObject x="58" y="87" width="580" height="34">
      <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:13px; color:#135; font-family:Arial; display:flex; flex-wrap:wrap; justify-content:space-between;">
        <div style="flex:1;">• E/e′ &gt; 14</div>
        <div style="flex:2; text-align:center;">• Septal e′ &lt; 7 cm/s or lat e′ &lt; 10 cm/s</div>
        <div style="flex:1.5; text-align:right;">• TR vel &gt; 2.8 m/s</div>
        <div style="flex:1.3; text-align:right;">• LAVI &gt; 34 mL/m²</div>
      </div>
    </foreignObject>
    <!-- Decision branches -->
    <line x1="140" y1="120" x2="140" y2="140" stroke="#8a8" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="350" y1="120" x2="350" y2="140" stroke="#886" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="560" y1="120" x2="560" y2="140" stroke="#a66" stroke-width="2" marker-end="url(#arrow)"/>
    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="3" refY="6" orient="auto" markerUnits="strokeWidth">
        <path d="M2,2 L2,10 L10,6 L2,2" fill="#888"/>
      </marker>
    </defs>
    <!-- Decision boxes -->
    <rect x="55" y="143" width="170" height="38" rx="8" fill="#e7f4ff" stroke="#bbb"/>
    <foreignObject x="55" y="146" width="170" height="33">
      <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:14px; text-align:center; color:#045; font-family:Arial;">
        ≤1 abnormal<br>
        <span style="color:#366; font-size:13px;">→ Normal</span>
      </div>
    </foreignObject>
    <rect x="265" y="143" width="170" height="38" rx="8" fill="#fff7e6" stroke="#bbb"/>
    <foreignObject x="265" y="146" width="170" height="33">
      <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:14px; text-align:center; color:#964; font-family:Arial;">
        2 abnormal<br>
        <span style="color:#b75; font-size:13px;">→ Indeterminate</span>
      </div>
    </foreignObject>
    <rect x="475" y="143" width="170" height="38" rx="8" fill="#ffe9e9" stroke="#bbb"/>
    <foreignObject x="475" y="146" width="170" height="33">
      <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:14px; text-align:center; color:#a32; font-family:Arial;">
        ≥3 abnormal<br>
        <span style="color:#d33; font-size:13px;">→ Grade diastolic dysfunction</span>
      </div>
    </foreignObject>
    <line x1="560" y1="181" x2="560" y2="210" stroke="#a44" stroke-width="2" marker-end="url(#arrow)"/>
    <!-- Step 2 grading box -->
    <rect x="120" y="215" width="460" height="145" rx="14" fill="#f0f8ec" stroke="#aac"/>
    <foreignObject x="130" y="220" width="440" height="135">
      <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:13px; font-family:Arial; color:#085;">
        <div style="font-size:16px; text-align:center; font-weight:bold;">Mitral Inflow + Supportive Criteria</div>
        <div style="margin-top:8px;"><b>E/A ≥ 2:</b> Grade III (Restrictive)</div>
        <div><b>E/A ≤ 0.8 and E ≤ 50 cm/s:</b> Grade I (Impaired relaxation)</div>
        <div><b>E/A ≤ 0.8 and E &gt; 50 cm/s, or 0.8 &lt; E/A &lt; 2:</b></div>
        <ul style="margin:2px 0 0 16px; padding-left:14px;">
          <li>Count positive: E/e′ &gt; 14, TR &gt; 2.8, LAVI &gt; 34</li>
          <li>If 2–3 positive → Grade II (Pseudo-normal)</li>
          <li>If 0–1 positive → Grade I</li>
          <li>If missing → Indeterminate</li>
        </ul>
      </div>
    </foreignObject>
  </svg>
</div>

<script>
function gradeDiastolic() {
  // Step 1: Four major criteria
  const ee = parseFloat(document.getElementById('ee').value);
  const septal = parseFloat(document.getElementById('septal').value);
  const lateral = parseFloat(document.getElementById('lateral').value);
  const tr = parseFloat(document.getElementById('tr').value);
  const lavi = parseFloat(document.getElementById('lavi').value);
  const ef_reduced = document.getElementById('ef_reduced').value === "yes";

  let abn = 0, total = 0;
  if (!isNaN(ee)) { if (ee > 14) abn++; total++; }
  if (!isNaN(septal) || !isNaN(lateral)) {
    if ((!isNaN(septal) && septal < 7) || (!isNaN(lateral) && lateral < 10)) abn++;
    total++;
  }
  if (!isNaN(tr)) { if (tr > 2.8) abn++; total++; }
  if (!isNaN(lavi)) { if (lavi > 34) abn++; total++; }

  if (!ef_reduced && total === 0) {
    document.getElementById('dfout').innerHTML = "Enter at least one criterion or indicate reduced EF.";
    return;
  }

  // Step 2: If >50% abnormal OR reduced EF, proceed to grading
  if ((abn / total > 0.5 && total > 0) || ef_reduced) {
    // Grading with mitral inflow
    const ea = parseFloat(document.getElementById('ea').value);
    const evel = parseFloat(document.getElementById('evel').value);

    if (isNaN(ea)) {
      document.getElementById('dfout').innerHTML = "Enter E/A ratio for grading.";
      return;
    }

    // E/A >= 2 = Grade III
    if (ea >= 2) {
      document.getElementById('dfout').innerHTML = "Grade III diastolic dysfunction (Restrictive filling: E/A ≥ 2)";
      return;
    }

    // E/A ≤ 0.8 and E ≤ 50 = Grade I
    if (ea <= 0.8 && !isNaN(evel) && evel <= 50) {
      document.getElementById('dfout').innerHTML = "Grade I diastolic dysfunction (Impaired relaxation: E/A ≤ 0.8 and E ≤ 50 cm/s)";
      return;
    }

    // E/A ≤ 0.8 and E > 50 OR 0.8 < E/A < 2
    if ((ea <= 0.8 && !isNaN(evel) && evel > 50) || (ea > 0.8 && ea < 2)) {
      // Now use 3 secondary criteria
      let crit = 0, avail = 0;
      if (!isNaN(ee)) { avail++; if (ee > 14) crit++; }
      if (!isNaN(tr)) { avail++; if (tr > 2.8) crit++; }
      if (!isNaN(lavi)) { avail++; if (lavi > 34) crit++; }
      if (avail < 2) {
        document.getElementById('dfout').innerHTML = "Need at least 2 of 3 secondary criteria (E/e′, TR velocity, LAVI) for grading.";
        return;
      } else if (crit >= 2) {
        document.getElementById('dfout').innerHTML = "Grade II diastolic dysfunction (Pseudo-normal filling: ≥2 secondary criteria positive)";
        return;
      } else if (crit === 1 && avail >= 2) {
        document.getElementById('dfout').innerHTML = "Indeterminate diastolic function (50% positive secondary criteria)";
        return;
      } else if (crit === 0 && avail >= 2) {
        document.getElementById('dfout').innerHTML = "Grade I diastolic dysfunction (<50% secondary criteria positive)";
        return;
      }
    }

    // If inputs are not complete for grading
    document.getElementById('dfout').innerHTML = "Insufficient data to assign grade.";
    return;
  }

  // <50% abnormal = Normal
  else if (abn / total < 0.5) {
    document.getElementById('dfout').innerHTML = "Normal diastolic function (<50% abnormal criteria)";
    return;
  }
  // 50% abnormal = Indeterminate
  else {
    document.getElementById('dfout').innerHTML = "Indeterminate diastolic function (50% abnormal criteria)";
    return;
  }
}
</script>
</body>
</html>

