function gradeDiastolic() {
  // 4 criteria
  const ee = parseFloat(document.getElementById('ee').value);
  const septal = parseFloat(document.getElementById('septal').value);
  const lateral = parseFloat(document.getElementById('lateral').value);
  const tr = parseFloat(document.getElementById('tr').value);
  const lavi = parseFloat(document.getElementById('lavi').value);

  // Abnormal count
  let abn = 0, crits = 0;
  if (!isNaN(ee)) { crits++; if (ee > 14) abn++; }
  if (!isNaN(septal) || !isNaN(lateral)) {
    crits++;
    if ((!isNaN(septal) && septal < 7) || (!isNaN(lateral) && lateral < 10)) abn++;
  }
  if (!isNaN(tr)) { crits++; if (tr > 2.8) abn++; }
  if (!isNaN(lavi)) { crits++; if (lavi > 34) abn++; }

  // If not enough entered
  if (crits < 2) {
    document.getElementById('dfout').innerHTML = "Please enter at least two of the 4 criteria for initial screen.";
    return;
  }

  if (abn <= 1) {
    document.getElementById('dfout').innerHTML = "Normal diastolic function (≤1 abnormal criteria)";
    return;
  }
  if (abn === 2) {
    document.getElementById('dfout').innerHTML = "Indeterminate diastolic function (2 abnormal criteria)";
    return;
  }

  // If ≥3, proceed to mitral inflow grading:
  const ea = parseFloat(document.getElementById('ea').value);
  const evel = parseFloat(document.getElementById('evel').value);
  if (isNaN(ea) || isNaN(evel)) {
    document.getElementById('dfout').innerHTML = "Diastolic dysfunction present (≥3 abnormal). Please enter E/A and E velocity for grading.";
    return;
  }

  // Mitral inflow grading (same as previous logic)
  if (ea >= 2) {
    document.getElementById('dfout').innerHTML = "Grade III diastolic dysfunction (Restrictive, ↑ LAP)";
    return;
  }
  if (ea <= 0.8 && evel <= 50) {
    document.getElementById('dfout').innerHTML = "Grade I diastolic dysfunction (Impaired relaxation, normal LAP)";
    return;
  }
  if ((ea <= 0.8 && evel > 50) || (ea > 0.8 && ea < 2)) {
    // Count secondary positives (E/e', TR, LAVI)
    let pos = 0, avail = 0;
    if (!isNaN(ee)) { avail++; if (ee > 14) pos++; }
    if (!isNaN(tr)) { avail++; if (tr > 2.8) pos++; }
    if (!isNaN(lavi)) { avail++; if (lavi > 34) pos++; }
    if (avail < 2) {
      document.getElementById('dfout').innerHTML = "Need at least 2 of 3 secondary criteria for grading.";
      return;
    }
    if (pos >= 2) {
      document.getElementById('dfout').innerHTML = "Grade II diastolic dysfunction (Pseudo-normal, ↑ LAP)";
      return;
    } else {
      document.getElementById('dfout').innerHTML = "Grade I diastolic dysfunction (normal LAP)";
      return;
    }
  }
  document.getElementById('dfout').innerHTML = "Insufficient or inconsistent data to assign grade.";
}


