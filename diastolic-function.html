<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ASE 2016 Diastolic Dysfunction Grading</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background: #f5faff; 
      margin: 0; 
      padding: 2em 0; 
    }
    .center {
      max-width: 460px;
      margin: 0 auto;
    }
    h2 { 
      color: #024; 
      margin-bottom: 0.5em;
      text-align: center;
    }
    .card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 3px 20px #bed4f2;
      padding: 2em 2.5em 2em 2.5em;
      margin-bottom: 2em;
      border: 1px solid #e7eefe;
    }
    label {
      font-weight: bold; 
      display: block;
      margin-bottom: 0.18em;
      color: #1565c0;
    }
    input[type="number"], select {
      width: 88%;
      font-size: 1.03em;
      padding: 5px 7px;
      margin-bottom: 1.2em;
      border-radius: 6px;
      border: 1px solid #b8c3d6;
      background: #fafdff;
    }
    .btn {
      width: 100%;
      padding: 10px 0;
      background: #1565c0;
      color: #fff;
      font-weight: bold;
      font-size: 1.1em;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      margin-top: 0.8em;
      transition: background 0.14s;
    }
    .btn:hover { background: #003e8b;}
    .result { 
      font-weight: bold; 
      font-size: 1.14em; 
      margin: 1.2em 0 0.8em 0; 
      color: #236; 
      padding: 1em;
      background: #ecf7f9;
      border-radius: 9px;
      min-height: 32px;
    }
    @media (max-width: 540px) {
      .center, .card { padding: 1em; }
    }
  </style>
</head>
<body>
<div class="center">
  <h2>ASE 2016 Diastolic Dysfunction Grading Tool</h2>
  <form id="diastolicForm" class="card" onsubmit="event.preventDefault(); gradeDiastolic();">
    <label for="ef_reduced">LVEF reduced?</label>
    <select id="ef_reduced">
      <option value="no">No</option>
      <option value="yes">Yes</option>
    </select>
    
    <label for="ee">E/e′</label>
    <input type="number" id="ee" step="0.1" placeholder="E/e′">
    
    <label for="septal">Septal e′ (cm/s)</label>
    <input type="number" id="septal" step="0.1" placeholder="Septal e′">
    
    <label for="lateral">Lateral e′ (cm/s)</label>
    <input type="number" id="lateral" step="0.1" placeholder="Lateral e′">
    
    <label for="tr">TR velocity (m/s)</label>
    <input type="number" id="tr" step="0.1" placeholder="TR velocity">
    
    <label for="lavi">LA volume index (ml/m²)</label>
    <input type="number" id="lavi" step="0.1" placeholder="LAVI">
    
    <label for="ea">E/A ratio</label>
    <input type="number" id="ea" step="0.01" placeholder="E/A">
    
    <label for="evel">Mitral E velocity (cm/s)</label>
    <input type="number" id="evel" step="0.1" placeholder="E velocity">
    
    <button type="submit" class="btn">Grade Diastolic Function</button>
  </form>
  <div class="result" id="dfout"></div>
</div>

<script>
function gradeDiastolic() {
  const ee = parseFloat(document.getElementById('ee').value);
  const septal = parseFloat(document.getElementById('septal').value);
  const lateral = parseFloat(document.getElementById('lateral').value);
  const tr = parseFloat(document.getElementById('tr').value);
  const lavi = parseFloat(document.getElementById('lavi').value);
  const ef_reduced = document.getElementById('ef_reduced').value === "yes";

  // Step 1: Primary 4 criteria
  let abn = 0, total = 0;
  if (!isNaN(ee)) { if (ee > 14) abn++; total++; }
  if (!isNaN(septal) || !isNaN(lateral)) {
    if ((!isNaN(septal) && septal < 7) || (!isNaN(lateral) && lateral < 10)) abn++;
    total++;
  }
  if (!isNaN(tr)) { if (tr > 2.8) abn++; total++; }
  if (!isNaN(lavi)) { if (lavi > 34) abn++; total++; }

  if (!ef_reduced && total === 0) {
    document.getElementById('dfout').innerHTML = "Enter at least one criterion or indicate reduced EF.";
    return;
  }

  // Step 2: If >50% abnormal or EF reduced, proceed to grading
  if ((abn / total > 0.5 && total > 0) || ef_reduced) {
    const ea = parseFloat(document.getElementById('ea').value);
    const evel = parseFloat(document.getElementById('evel').value);

    if (isNaN(ea)) {
      document.getElementById('dfout').innerHTML = "Enter E/A ratio for grading.";
      return;
    }

    if (ea >= 2) {
      document.getElementById('dfout').innerHTML = "Grade III diastolic dysfunction (Restrictive filling: E/A ≥ 2)";
      return;
    }
    if (ea <= 0.8 && !isNaN(evel) && evel <= 50) {
      document.getElementById('dfout').innerHTML = "Grade I diastolic dysfunction (Impaired relaxation: E/A ≤ 0.8 and E ≤ 50 cm/s)";
      return;
    }
    // E/A ≤ 0.8 and E > 50 OR 0.8 < E/A < 2
    if ((ea <= 0.8 && !isNaN(evel) && evel > 50) || (ea > 0.8 && ea < 2)) {
      // Now use 3 secondary criteria
      let crit = 0, avail = 0;
      if (!isNaN(ee)) { avail++; if (ee > 14) crit++; }
      if (!isNaN(tr)) { avail++; if (tr > 2.8) crit++; }
      if (!isNaN(lavi)) { avail++; if (lavi > 34) crit++; }
      if (avail < 2) {
        document.getElementById('dfout').innerHTML = "Need at least 2 of 3 secondary criteria (E/e′, TR velocity, LAVI) for grading.";
        return;
      } else if (crit >= 2) {
        document.getElementById('dfout').innerHTML = "Grade II diastolic dysfunction (Pseudo-normal filling: ≥2 secondary criteria positive)";
        return;
      } else if (crit === 1 && avail >= 2) {
        document.getElementById('dfout').innerHTML = "Indeterminate diastolic function (50% positive secondary criteria)";
        return;
      } else if (crit === 0 && avail >= 2) {
        document.getElementById('dfout').innerHTML = "Grade I diastolic dysfunction (<50% secondary criteria positive)";
        return;
      }
    }
    document.getElementById('dfout').innerHTML = "Insufficient data to assign grade.";
    return;
  } else if (abn / total < 0.5) {
    document.getElementById('dfout').innerHTML = "Normal diastolic function (<50% abnormal criteria)";
    return;
  } else {
    document.getElementById('dfout').innerHTML = "Indeterminate diastolic function (50% abnormal criteria)";
    return;
  }
}
</script>
</body>
</html>


