<script>
function calcAAZ() {
  let height = parseFloat(document.getElementById('aa_height').value);
  let weight = parseFloat(document.getElementById('aa_weight').value);
  let diam_cm = parseFloat(document.getElementById('aa_diam').value);
  let age = parseFloat(document.getElementById('aa_age').value);
  let sex = document.getElementById('aa_gender').value; // "Male" or "Female"

  // Unit conversions
  if (document.getElementById('aa_height_unit').value === "in") height = height * 2.54;
  if (document.getElementById('aa_weight_unit').value === "lb") weight = weight / 2.20462;

  // BSA (DuBois & DuBois)
  let bsa = 0.007184 * Math.pow(height, 0.725) * Math.pow(weight, 0.425);

  // Input: ascending aorta in mm!
  let aa_mm = diam_cm * 10.0;
  let log_aa = Math.log10(aa_mm);
  let log_bsa = Math.log10(bsa);

  // Predicted mean (in log10 mm)
  let mean_pred_log;
  if (sex === "Male") {
    mean_pred_log = 0.518 + 0.438 * log_bsa + 0.013 * age;
  } else {
    mean_pred_log = 0.508 + 0.450 * log_bsa + 0.011 * age;
  }
  // Convert predicted mean from log10(mm) to mm
  let mean_pred_mm = Math.pow(10, mean_pred_log);

  let z = (log_aa - mean_pred_log) / 0.045;

  // Severity
  let sev = "Normal";
  if (z >= 4) sev = "Severely dilated";
  else if (z >= 3) sev = "Moderately dilated";
  else if (z >= 2) sev = "Mildly dilated";

  document.getElementById('aa_zout').innerHTML =
    `Z-score: <span>${z.toFixed(2)}</span> (${sev})<br>
    <small>Campens 2014 | Predicted mean: ${mean_pred_mm.toFixed(1)} mm (${(mean_pred_mm/10).toFixed(2)} cm) | SD: 0.045 (log₁₀ mm) | BSA: ${bsa.toFixed(2)} m²</small>`;
}
</script>


