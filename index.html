<!-- ASCENDING AORTA Z-SCORE CALCULATOR -->
<div class="section">
  <h2>Ascending Aorta Z-Score Calculator (Campens et al., 2014)</h2>
  <form id="aaform" onsubmit="event.preventDefault(); calcAAZ();">
    <label>Age (years):</label>
    <input type="number" id="aa_age" value="40" min="1" max="120" step="1">
    &nbsp;&nbsp;
    <label>Height:</label>
    <input type="number" id="aa_height" value="66" min="10" max="100" step="0.1">
    <select id="aa_height_unit">
      <option value="in">inches</option>
      <option value="cm">cm</option>
    </select>
    &nbsp;&nbsp;
    <label>Weight:</label>
    <input type="number" id="aa_weight" value="150" min="10" max="500" step="0.1">
    <select id="aa_weight_unit">
      <option value="lb">lbs</option>
      <option value="kg">kg</option>
    </select>
    <br>
    <label>Gender:</label>
    <select id="aa_gender">
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
    &nbsp;&nbsp;
    <label>Ascending Aorta Diameter (cm):</label>
    <input type="number" id="aa_diam" value="3.0" min="1" max="10" step="0.01">
    <br>
    <button type="button" onclick="calcAAZ()">Calculate Z-score</button>
  </form>
  <div class="zscore-result" id="aa_zout"></div>
</div>

<script>
function calcAAZ() {
  // Get values
  let height = parseFloat(document.getElementById('aa_height').value);
  let weight = parseFloat(document.getElementById('aa_weight').value);
  let diam_cm = parseFloat(document.getElementById('aa_diam').value);
  let age = parseFloat(document.getElementById('aa_age').value);
  let sex = document.getElementById('aa_gender').value; // "Male" or "Female"

  // Unit conversions
  if (document.getElementById('aa_height_unit').value === "in") height = height * 2.54;
  if (document.getElementById('aa_weight_unit').value === "lb") weight = weight / 2.20462;

  // BSA (Dubois & Dubois)
  let bsa = 0.007184 * Math.pow(height, 0.725) * Math.pow(weight, 0.425);

  // Use Campens 2014 formula, input in mm:
  let aa_mm = diam_cm * 10.0;
  let log_aa = Math.log10(aa_mm);
  let log_bsa = Math.log10(bsa);

  let mean_pred;
  if (sex === "Male") {
    mean_pred = 0.518 + 0.438 * log_bsa + 0.013 * age;
  } else {
    mean_pred = 0.508 + 0.450 * log_bsa + 0.011 * age;
  }
  let z = (log_aa - mean_pred) / 0.045;

  // Severity
  let sev = "Normal";
  if (z >= 4) sev = "Severely dilated";
  else if (z >= 3) sev = "Moderately dilated";
  else if (z >= 2) sev = "Mildly dilated";

  document.getElementById('aa_zout').innerHTML =
    `Z-score: <span>${z.toFixed(2)}</span> (${sev})<br>
    <small>Campens 2014 | Predicted mean (log10 mm): ${mean_pred.toFixed(3)} | BSA: ${bsa.toFixed(2)} mÂ²</small>`;
}
</script>


